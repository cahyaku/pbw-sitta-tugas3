<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informasi Stok Bahan Ajar - SITTA</title>

    <!-- CSS Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Ikon Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- CSS Kustom -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body class="dashboard-page">
    <div id="app">
        <!-- Navigasi -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold" href="dashboard.html">
                    <i class="bi bi-mortarboard-fill me-2"></i>SITTA - Informasi Stok
                </a>
                <div class="navbar-nav ms-auto">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>
                            <span v-text="userName">User</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="dashboard.html"><i
                                        class="bi bi-house me-2"></i>Dashboard</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#" @click.prevent="logout"><i
                                        class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Success Alert Overlay -->
        <div v-if="successAlert.show" class="success-overlay">
            <div class="success-modal">
                <div class="text-center">
                    <div class="success-icon mb-3">
                        <i class="bi bi-check-circle-fill"></i>
                    </div>
                    <h3 class="text-success mb-2">{{ successAlert.title }}</h3>
                    <p class="mb-3">{{ successAlert.message }}</p>
                    <button type="button" class="btn btn-success" @click="hideSuccessAlert">
                        <i class="bi bi-check me-2"></i>OK
                    </button>
                </div>
            </div>
        </div>

        <div class="container-fluid mt-4">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card welcome-card">
                        <div class="card-body text-center py-4 position-relative">
                            <a href="dashboard.html" class="btn btn-primary position-absolute"
                                style="top: 15px; right: 15px;" title="Kembali ke Dashboard">
                                <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
                            </a>
                            <h2 class="card-title mb-3">
                                <i class="bi bi-box-seam me-2"></i>Informasi Stok Bahan Ajar
                            </h2>
                            <p class="card-text">
                                Kelola dan monitor stok bahan ajar SITTA - Universitas Terbuka
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="row mb-3">
                <div class="col-md-3 mb-2">
                    <input type="text" class="form-control" v-model="searchQuery"
                        placeholder="Cari kode atau nama mata kuliah...">
                </div>
                <div class="col-md-2 mb-2">
                    <select class="form-select" v-model="filterKategori">
                        <option value="">Semua Kategori</option>
                        <option v-for="kategori in kategoriList" :key="kategori" :value="kategori">{{ kategori }}
                        </option>
                    </select>
                </div>
                <div class="col-md-2 mb-2">
                    <select class="form-select" v-model="filterUpbjj">
                        <option value="">Semua UT Daerah</option>
                        <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">{{ upbjj }}</option>
                    </select>
                </div>
                <div class="col-md-3 mb-2">
                    <select class="form-select" v-model="sortBy">
                        <option value="">Urutkan Berdasarkan</option>
                        <option value="judul-asc">Judul (A-Z)</option>
                        <option value="judul-desc">Judul (Z-A)</option>
                        <option value="qty-asc">Stok (Terendah)</option>
                        <option value="qty-desc">Stok (Tertinggi)</option>
                        <option value="harga-asc">Harga (Termurah)</option>
                        <option value="harga-desc">Harga (Termahal)</option>
                    </select>
                </div>
                <div class="col-md-2 mb-2">
                    <button class="btn btn-secondary w-100" @click="resetFilters">
                        <i class="bi bi-arrow-clockwise me-1"></i>Reset
                    </button>
                </div>
            </div>

            <!-- Stock Table Component -->
            <div class="row">
                <div class="col-12">
                    <stock-table :items="filteredStok" @add-stock="showAddStockModal" @edit-stock="editStock">
                    </stock-table>
                </div>
            </div>
        </div>

        <!-- Modal Component -->
        <app-modal modal-id="addStockModal" :title="editMode ? 'Edit Stok Bahan Ajar' : 'Tambah Stok Bahan Ajar Baru'"
            :icon-class="editMode ? 'bi bi-pencil' : 'bi bi-plus-circle'" size="lg"
            :confirm-text="editMode ? 'Update Stok' : 'Tambah Stok'" @confirm="saveStock">

            <!-- Alert di dalam modal -->
            <div v-if="formAlert.show" class="alert" :class="formAlert.type" role="alert">
                <div class="d-flex align-items-center">
                    <i :class="formAlert.icon" class="me-2"></i>
                    <div>
                        <strong>{{ formAlert.title }}</strong>
                        <div class="mt-1">{{ formAlert.message }}</div>
                    </div>
                    <button type="button" class="btn-close ms-auto" @click="hideFormAlert"></button>
                </div>
            </div>

            <!-- Form -->
            <form @submit.prevent="saveStock">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Kode Mata Kuliah</label>
                        <input type="text" class="form-control" v-model.trim="formData.kode"
                            placeholder="Contoh: EKMA4116" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nama Mata Kuliah</label>
                        <input type="text" class="form-control" v-model.trim="formData.judul"
                            placeholder="Contoh: Pengantar Manajemen" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Kategori</label>
                        <select class="form-select" v-model="formData.kategori" required>
                            <option value="">Pilih Kategori</option>
                            <option v-for="kategori in kategoriList" :key="kategori" :value="kategori">{{ kategori }}
                            </option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">UT-Daerah</label>
                        <select class="form-select" v-model="formData.upbjj" required>
                            <option value="">Pilih UT Daerah</option>
                            <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">{{ upbjj }}</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Lokasi Rak</label>
                        <input type="text" class="form-control" v-model.trim="formData.lokasiRak"
                            placeholder="Contoh: R1-A3" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Jumlah Stok</label>
                        <input type="number" class="form-control" v-model.number="formData.qty" placeholder="0" min="0"
                            required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Safety Stock</label>
                        <input type="number" class="form-control" v-model.number="formData.safety" placeholder="0"
                            min="0" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Harga</label>
                        <input type="number" class="form-control" v-model.number="formData.harga" placeholder="0"
                            min="0" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Catatan</label>
                    <textarea class="form-control" v-model="formData.catatanHTML" rows="2"
                        placeholder="Catatan tambahan (opsional)"></textarea>
                    <small class="text-muted">Anda dapat menggunakan HTML tags</small>
                </div>

                <div v-if="stockWarning" class="alert alert-warning" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>{{ stockWarning }}
                </div>
            </form>
        </app-modal>
    </div>

    <!-- Vue Component Templates (Inline) -->
    <script type="text/x-template" id="stock-table-template">
        <div class="card">
            <div class="card-header bg-gradient text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-table me-2"></i>Daftar Stok Bahan Ajar
                        <span class="badge bg-light text-dark ms-2">{{ itemCount }} item</span>
                    </h5>
                    <button class="btn fw-bold"
                        style="background-color: #FFF9C4; border-color: #FFF9C4; color: #333;"
                        @click="$emit('add-stock')">
                        <i class="bi bi-plus-circle me-2"></i>Tambah Stok Baru
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead style="background-color: #e5e5e5;">
                            <tr>
                                <th>No</th>
                                <th>Kode MK</th>
                                <th>Nama Mata Kuliah</th>
                                <th>Harga</th>
                                <th>Kategori</th>
                                <th>UT-Daerah</th>
                                <th>Lokasi Rak</th>
                                <th class="text-center">Stok</th>
                                <th class="text-center">Safety Stock</th>
                                <th>Status</th>
                                <th>Catatan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="items.length === 0">
                                <td colspan="12" class="text-center text-muted py-4">
                                    <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                    Tidak ada data stok bahan ajar yang ditemukan
                                </td>
                            </tr>
                            <tr v-else v-for="(item, index) in items" :key="item.kode">
                                <td>{{ index + 1 }}</td>
                                <td><span class="badge bg-secondary">{{ item.kode }}</span></td>
                                <td>{{ item.judul }}</td>
                                <td>Rp {{ item.harga.toLocaleString('id-ID') }}</td>
                                <td><span class="badge bg-info">{{ item.kategori }}</span></td>
                                <td>{{ item.upbjj }}</td>
                                <td><span class="badge bg-dark">{{ item.lokasiRak }}</span></td>
                                <td class="text-center">
                                    <span class="fw-bold" :class="getStockClass(item.qty)">{{ item.qty }}</span>
                                </td>
                                <td class="text-center">{{ item.safety }}</td>
                                <td class="text-center">
                                    <span class="badge" :class="getStatusBadgeClass(item)">{{ getStatusText(item) }}</span>
                                </td>
                                <td>
                                    <small v-html="item.catatanHTML"></small>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary me-1"
                                        @click="$emit('edit-stock', index)" title="Edit">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </script>

    <script type="text/x-template" id="app-modal-template">
        <div class="modal fade" :id="modalId" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog" :class="sizeClass">
                <div class="modal-content">
                    <div class="modal-header" :class="headerClass">
                        <h5 class="modal-title">
                            <i :class="iconClass" class="me-2"></i>
                            {{ title }}
                        </h5>
                        <button type="button" class="btn-close" :class="closeButtonClass" 
                            data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <slot></slot>
                    </div>
                    <div class="modal-footer" v-if="showFooter">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-2"></i>{{ cancelText }}
                        </button>
                        <button type="button" class="btn" :class="confirmBtnClass" @click="$emit('confirm')">
                            <i class="bi bi-check-circle me-2"></i>{{ confirmText }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <!-- JS Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- JS Data -->
    <script src="js/components/data.js"></script>
    <!-- JS App (Vue Root) -->
    <script src="js/app.js"></script>
    <!-- JS API Service -->
    <script src="js/services/api.js"></script>
    <!-- JS Vue Components -->
    <script src="js/components/stock-table.js"></script>
    <script src="js/components/app-modal.js"></script>
    <!-- JS Page Component -->
    <script src="js/components/stok.js"></script>
</body>

</html>